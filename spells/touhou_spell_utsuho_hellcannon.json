[
  {
    "id": "utsuho_hellcannon_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_hellcannon2" }, "targeted": true },
      { "u_cast_spell": { "id": "hellcannon_to_mon" }, "targeted": false },
      { "queue_eocs": [ "queue_hellcannon_to_mon_eoc" ], "time_in_future": "3 s" }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "-=", "50" ] },
      { "u_cast_spell": { "id": "utsuho_hellcannon2_unc" }, "targeted": true },
      { "u_cast_spell": { "id": "hellcannon_to_mon_unc" }, "targeted": false },
      { "queue_eocs": [ "queue_hellcannon_to_mon_eoc" ], "time_in_future": "3 s" }
    ],
    "//": "Every time Utsuho casts utsuho_hellcannon she checks if she's wearing her third leg and:",
    "//2": "shoots hellcannon + runs the spell that tags *nearby* mon_utsuho_minisun with the EOC + queues a EOC to reduce the tag"
  },
  {
    "id": "hellcannon_to_mon",
    "type": "SPELL",
    "name": { "str": "Hell wave cannon (add var)" },
    "description": "This adds the condition for mon_utsuho_minisun to cast the spell",
    "spell_class": "NONE",
    "valid_targets": [ "ally", "hostile" ],
    "targeted_monster_ids": [ "mon_utsuho_minisun" ],
    "effect": "effect_on_condition",
    "effect_str": "hellcannon_to_mon_eoc",
    "shape": "blast",
    "max_level": 1,
    "min_aoe": 16,
    "max_aoe": 16,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "IGNORE_WALLS", "NO_FAIL", "NO_HANDS", "NO_LEGS", "NO_PROJECTILE" ]
  },
  {
    "id": "hellcannon_to_mon_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_hellcannon_cast", "+=", "1" ] }
    ]
  },
  {
    "id": "hellcannon_to_mon_unc",
    "type": "SPELL",
    "name": { "str": "Hell wave cannon (add var) (uncontrollable)" },
    "description": "This adds the condition for mon_utsuho_minisun to cast the uncontrollable version of the spell",
    "spell_class": "NONE",
    "valid_targets": [ "ally", "hostile" ],
    "targeted_monster_ids": [ "mon_utsuho_minisun" ],
    "effect": "effect_on_condition",
    "effect_str": "hellcannon_to_mon_unc_eoc",
    "shape": "blast",
    "max_level": 1,
    "min_aoe": 16,
    "max_aoe": 16,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "IGNORE_WALLS", "NO_FAIL", "NO_HANDS", "NO_LEGS", "NO_PROJECTILE" ]
  },
  {
    "id": "hellcannon_to_mon_unc_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_hellcannon_unc_cast", "+=", "1" ] }
    ]
  },
  {
    "id": "queue_hellcannon_to_mon_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "u_cast_spell": { "id": "hellcannon_to_mon_zero" }, "targeted": false }
    ],
    "//": "Note: this is a workaround for mon_hellcannon_msun_reduce_eoc !",
    "//2": "The minisuns are NOT running the EOC, so if this isn't forced on them they will keep shooting the spell"
  },
  {
    "id": "hellcannon_to_mon_zero",
    "type": "SPELL",
    "name": { "str": "Hell wave cannon (reduce var)" },
    "description": "This reduces the condition for mon_utsuho_minisun to cast the spell",
    "spell_class": "NONE",
    "valid_targets": [ "ally", "hostile" ],
    "targeted_monster_ids": [ "mon_utsuho_minisun" ],
    "effect": "effect_on_condition",
    "effect_str": "hellcannon_to_mon_zero_eoc",
    "shape": "blast",
    "max_level": 1,
    "min_aoe": 32,
    "max_aoe": 32,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "IGNORE_WALLS", "NO_FAIL", "NO_HANDS", "NO_LEGS", "NO_PROJECTILE" ]
  },
  {
    "id": "hellcannon_to_mon_zero_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_hellcannon_cast", "-=", "1" ] },
      { "math": [ "u_var_hellcannon_unc_cast", "-=", "1" ] }
    ]
  },
  {
    "id": "mon_hellcannon_msun2",
    "type": "SPELL",
    "name": "Hell wave cannon (minisun)",
    "description": "Replica of utsuho_hellcannon2 casted by mon_utsuho_minisun ",
    "spell_class": "NONE",
    "valid_targets": [ "hostile" ],
    "effect": "attack",
    "extra_effects": [ { "id": "mon_hellcannon_msun_reduce" } ],
    "shape": "line",
    "damage_type": "heat",
    "min_damage": { "math": [ "var_hellcannon_dmg" ] },
    "max_damage": 297,
    "min_range": { "math": [ "var_hellcannon_range" ] },
    "max_range": 24,
    "field_id": "fd_laser",
    "field_chance": 1,
    "min_field_intensity": 1,
    "max_field_intensity": 1,
    "max_level": 1,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "NO_HANDS", "NO_LEGS" ],
    "//": "The vars are refreshed and set by utsuho_opens_spellbook_eoc every time Utsuho opens the window to cast spells"
  },
  {
    "id": "mon_hellcannon_msun2_unc",
    "type": "SPELL",
    "name": "Hell wave cannon (minisun) (uncontrollable)",
    "description": "Replica of utsuho_hellcannon2_unc casted by mon_utsuho_minisun ",
    "spell_class": "NONE",
    "valid_targets": [ "hostile" ],
    "effect": "attack",
    "extra_effects": [ { "id": "mon_hellcannon_msun_reduce" } ],
    "shape": "line",
    "damage_type": "heat",
    "min_damage": 0,
    "max_damage": { "math": [ "var_hellcannon_dmg" ] },
    "min_range": { "math": [ "var_hellcannon_range" ] },
    "max_range": 24,
    "field_id": "fd_laser",
    "field_chance": 1,
    "min_field_intensity": 1,
    "max_field_intensity": 1,
    "max_level": 1,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "NO_HANDS", "NO_LEGS", "RANDOM_DAMAGE" ]
  },
  {
    "id": "mon_hellcannon_msun_reduce",
    "type": "SPELL",
    "name": "Hell wave cannon (minisun) (reduce EOC)",
    "description": "Forces the target to run the EOC, which reduces u_var_hellcannon_unc_cast to (their) self",
    "spell_class": "NONE",
    "valid_targets": [ "self" ],
    "effect": "effect_on_condition",
    "effect_str": "mon_hellcannon_msun_reduce_eoc",
    "shape": "blast",
    "damage_type": "pure",
    "min_aoe": 16,
    "max_aoe": 16,
    "max_level": 1,
    "difficulty": -50,
    "base_casting_time": 0,
    "base_energy_cost": 0,
    "energy_source": "MANA",
    "flags": [ "NO_FAIL", "NO_HANDS", "NO_LEGS", "NO_PROJECTILE" ],
    "//": "WIP. The last step to make this work is to reduce u_var_hellcannon_cast by one each time this is cast, but the EOC is not being run/recognized by mon_utsuho_minisun ",
    "//2": "Note: if ground is added to valid_targets it may throw a 'Tried to use an invalid alpha talker' error"
  },
  {
    "id": "mon_hellcannon_msun_reduce_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "u_var_hellcannon_cast", "-=", "1" ] },
      { "math": [ "u_var_hellcannon_unc_cast", "-=", "1" ] }
    ],
    "//": "WIP. This is NOT reducing their u_var . A workaround is queueing queue_hellcannon_to_mon_eoc "
  }
]
