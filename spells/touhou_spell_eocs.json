[
  {
    "id": "dash_kokoro_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "u_cast_spell": { "id": "dash_kokoro2" }, "targeted": true },
      { "run_eocs": [ "dash_kokoro_aoe_eoc" ] }
    ]
  },
  {
    "id": "dash_kokoro_aoe_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_kokoro3" }, "targeted": false }
    ]
  },
  {
    "id": "dash_mokou_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "dash_mokou_dash_eoc" ] }
    ]
  },
  {
    "id": "dash_mokou_dash_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_mokou3" }, "targeted": true }
    ]
  },
  {
    "id": "meiling_mountainbreak_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "1" ] },
      { "run_eocs": [ "meiling_mountainbreak_check" ] },
      { "queue_eocs": [ "meiling_mountainbreak_timer" ], "time_in_future": "2 s" }
    ],
    "//": "When the spell is cast this sets the var to 1, runs the check and prepares the var to reset after 2 s"
  },
  {
    "id": "meiling_mountainbreak_check",
    "type": "effect_on_condition",
    "recurrence": "1 s",
    "condition": {
      "and": [
        { "math": [ "var_mountainbreakcasted", "==", "1" ] },
        { "math": [ "var_meilingblock", "==", "1" ] }
      ]
    },
    "effect": [ 
      { "u_cast_spell": { "id": "meiling_mountainbreak2" }, "targeted": true }
    ],
    "deactivate_condition": { "math": [ "var_mountainbreakcasted", "==", "0" ] },
    "//": "The check is active only if: Meiling has cast the spell, and she has blocked in the last 2 seconds (onblock_eocs), if so she will cast the damage component of the spell. The recurrence deactivates if the var is zero, so it doesn't run all the time"
  },
  {
    "id": "meiling_mountainbreak_timer",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "0" ] }
    ],
    "//": "This and the timer below, are triggered 2 s after Meiling gains the 'spell casted' and 'blocked' vars, respectively"
  },
  {
    "id": "meiling_mountainbreak_timer2",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_meilingblock", "=", "0" ] }
    ]
  },
  {
    "id": "sakuya_maidsecret_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_sakuyafocus", "+=", "1" ] },
      { "math": [ "var_sakuyaradius", "=", "( - (u_skill('stabbing') * 0.4 ) - (u_skill('dodge') * 0.4 ) + 17.2 )" ] },
      { "run_eocs": [ "sakuya_maidsecret_cycle1" ] }
    ],
    "//": "This EOC is a simplified version of udonge_waveinsight_start ",
    "//2": "var_sakuyaradius sets the detection radius to that formula, 16 - 6 tiles scaling down with higher (stabbing + dodge)"
  },
  {
    "id": "sakuya_maidsecret_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_sakuyafocus", "<", "2" ] },
    "effect": [ { "run_eocs": [ "sakuya_maidsecret_cycle2" ] } ],
    "false_effect": { "run_eocs": "sakuya_maidsecret_toggle" }
  },
  {
    "id": "sakuya_maidsecret_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "100" ] },
        { "math": [ "u_val('stamina')", ">=", "2000" ] },
        { "math": [ "var_sakuyafocus", ">", "0" ] },
        { "math": [ "u_monsters_nearby('radius': var_sakuyaradius )", "<", "1" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('stamina')", "+=", "1" ] },
      { "u_add_effect": "sakuya_maidsecret_effect", "duration": "3 s" },
      { "queue_eocs": [ "sakuya_maidsecret_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "sakuya_maidsecret_broken" }
  },
  {
    "id": "sakuya_maidsecret_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_sakuyafocus", ">=", "2" ] },
    "effect": [
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "sakuya_maidsecret_broken",
    "type": "effect_on_condition",
    "effect": [
      { "u_message": "You lose your concentration.", "type": "mixed" },
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "udonge_waveinsight_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "+=", "1" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveinsight_cycle1" ] }
    ],
    "//": "Always activates every time the spell udonge_waveinsight is cast. It sets var_waveinsight > 0 to signal that aura is ON. It also sets the other auras OFF",
    "//2": "This is the 'base aura', the others are modeled after this"
  },
  {
    "id": "udonge_waveinsight_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveinsight_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveinsight_toggle" },
    "//": "This is immediately checked after the previous eoc: if the player has casted the spell just once then var_waveinsight < 2, so cycle2 is run. However, if the player has casted the spell twice then var_waveinsight >= 2, so it runs the toggle EOC instead"
  },
  {
    "id": "udonge_waveinsight_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_waveinsight", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "1" ] },
      { "u_add_effect": "udonge_insight", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveinsight_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" },
    "//": "This keeps the aura active as long as the player has enough mana, plus reduces it a bit. Otherwise the udonge_wave_oom stop triggers"
  },
  {
    "id": "udonge_waveinsight_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" }
    ],
    "//": "If the player has cast udonge_waveinsight twice, this runs and deactivates the aura"
  },
  {
    "id": "udonge_wave_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "50" ] },
    "effect": [
      { "u_message": "You are too mentally exhausted!  You lose focus of the wavelengths.", "type": "bad" },
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" }
    ],
    "//": "If the player runs reaches the amount of mana specified above, the aura(s) deactivate"
  },
  {
    "id": "udonge_wavemfortitude_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "+=", "1" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_wavemfortitude_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavemfortitude_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavemfortitude_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavemfortitude_toggle" }
  },
  {
    "id": "udonge_wavemfortitude_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_wavemfortitude", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_mfortitude", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavemfortitude_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavemfortitude_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" }
    ]
  },
  {
    "id": "udonge_waveperception_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "+=", "1" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveperception_cycle1" ] }
    ]
  },
  {
    "id": "udonge_waveperception_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveperception_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveperception_toggle" }
  },
  {
    "id": "udonge_waveperception_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_waveperception", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_perception", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveperception_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_waveperception_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveperception", "=", "0" ] },
      { "u_lose_effect": "udonge_perception" }
    ]
  },
  {
    "id": "udonge_wavestealth_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "+=", "1" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "run_eocs": [ "udonge_wavestealth_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavestealth_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavestealth_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavestealth_toggle" }
  },
  {
    "id": "udonge_wavestealth_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_wavestealth", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "10" ] },
      { "u_add_effect": "udonge_stealth", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavestealth_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavestealth_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_stealth" }
    ]
  },
  {
    "id": "yamame_damnedrope_start",
    "type": "effect_on_condition",
    "condition": { "u_has_trait": "TSUCHIGUMO_SPECIES" },
    "effect": [ { "u_add_trait": "damnedrope_str_mut" }, { "queue_eocs": [ "yamame_damnedrope_end" ], "time_in_future": "5 s" } ]
  },
  {
    "id": "yamame_damnedrope_end",
    "type": "effect_on_condition",
    "condition": { "u_has_trait": "damnedrope_str_mut" },
    "effect": [ { "u_lose_trait": "damnedrope_str_mut" } ]
  }
]
