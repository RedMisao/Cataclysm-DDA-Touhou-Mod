[
  {
    "id": "wield_weapon_dmg_eoc",
    "type": "effect_on_condition",
    "eoc_type": "EVENT",
    "required_event": "character_wields_item", 
    "effect": [ 
      {
        "u_run_inv_eocs": "all",
        "search_data": [ { "wielded_only": true } ],
        "true_eocs": [
          {
            "id": "wield_weapon_dmg_eoc2",
            "effect": [
              { "math": [ "var_melee_bash_dmg", "=", "n_melee_damage('bash')" ] },
              { "math": [ "var_melee_cut_dmg", "=", "n_melee_damage('cut')" ] },
              { "math": [ "var_melee_stab_dmg", "=", "n_melee_damage('stab')" ] },
              { "math": [ "var_melee_all_dmg", "=", "n_melee_damage('ALL')" ] },
              { "math": [ "var_melee_phys_dmg", "=", "var_melee_bash_dmg + var_melee_cut_dmg + var_melee_stab_dmg" ] },
              { "math": [ "var_gun_dmg", "=", "n_gun_damage('ALL')" ] }
            ]
          }
        ]
      }
    ],
    "//": "Thank you so much andrei8l for #71234 !!!",
    "//2": "Note: this is automatic but only detects wielding/unwielding actions, things like 'type: transform' from use_action don't update the values. If this becomes a problem update the value check every time the spell is cast"
  },
  {
    "id": "dash_kokoro_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "u_cast_spell": { "id": "dash_kokoro2" }, "targeted": true },
      { "run_eocs": [ "dash_kokoro_aoe_eoc" ] }
    ]
  },
  {
    "id": "dash_kokoro_aoe_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_kokoro3" }, "targeted": false }
    ]
  },
  {
    "id": "dash_mokou_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "dash_mokou_dash_eoc" ] }
    ]
  },
  {
    "id": "dash_mokou_dash_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "dash_mokou3" }, "targeted": true }
    ]
  },
  {
    "id": "kokoro_backsweep_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "QUARTERSTAVES" },
        { "u_has_wielded_with_weapon_category": "SPEARS" },
        { "u_has_wielded_with_weapon_category": "POLEARMS" },
        { "u_has_wielded_with_weapon_category": "GREAT_AXES" }
      ]
    },
    "effect": [
      { "run_eocs": [ "kokoro_backsweep_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You don't have any 2h weapons equipped.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Kokoro is wielding any 2h, if she isn't the cast fails"
  },
  {
    "id": "kokoro_backsweep_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_cut_dmg" ] },
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_bash" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_backsweep_check2" ] } ]
  },
  {
    "id": "kokoro_backsweep_check2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_backsweep_check3" ] } ]
  },
  {
    "id": "kokoro_backsweep_check3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_cut_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_backsweep2_stab" }, "targeted": true }
    ]
  },
  {
    "id": "kokoro_quick_attack_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "BATONS" },
        { "u_has_wielded_with_weapon_category": "HAND_AXES" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },  
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "QUARTERSTAVES" },
        { "u_has_wielded_with_weapon_category": "SPEARS" },
        { "u_has_wielded_with_weapon_category": "POLEARMS" },
        { "u_has_wielded_with_weapon_category": "GREAT_AXES" }
      ]
    },
    "effect": [
      { "run_eocs": [ "kokoro_quick_attack_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You're not using any compatible weapons.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Kokoro is wielding any weapon allowed by her MA, if she isn't the cast fails"
  },
  {
    "id": "kokoro_quick_attack_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_cut_dmg" ] },
        { "math": [ "var_melee_bash_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_bash" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_quick_attack_check2" ] } ]
  },
  {
    "id": "kokoro_quick_attack_check2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "run_eocs": [ "kokoro_quick_attack_check3" ] } ]
  },
  {
    "id": "kokoro_quick_attack_check3",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_stab_dmg", ">=", "var_melee_cut_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "kokoro_quick_attack2_stab" }, "targeted": true }
    ]
  },
  {
    "id": "meiling_mountainbreak_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "1" ] },
      { "run_eocs": [ "meiling_mountainbreak_check" ] },
      { "queue_eocs": [ "meiling_mountainbreak_timer" ], "time_in_future": "2 s" }
    ],
    "//": "When the spell is cast this sets the var to 1, runs the check and prepares the var to reset after 2 s"
  },
  {
    "id": "meiling_mountainbreak_check",
    "type": "effect_on_condition",
    "recurrence": "1 s",
    "condition": {
      "and": [
        { "math": [ "var_mountainbreakcasted", "==", "1" ] },
        { "math": [ "var_meilingblock", "==", "1" ] }
      ]
    },
    "deactivate_condition": { "math": [ "var_mountainbreakcasted", "==", "0" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "meiling_mountainbreak2" }, "targeted": true }
    ],
    "//": "The check is active only if: Meiling has cast the spell, and she has blocked in the last 2 seconds (onblock_eocs), if so she will cast the damage component of the spell. The recurrence deactivates if the var is zero, so it doesn't run all the time"
  },
  {
    "id": "meiling_mountainbreak_timer",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mountainbreakcasted", "=", "0" ] }
    ],
    "//": "This and the timer below, are triggered 2 s after Meiling gains the 'spell casted' and 'blocked' vars, respectively"
  },
  {
    "id": "meiling_mountainbreak_timer2",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_meilingblock", "=", "0" ] }
    ]
  },
  {
    "id": "mokou_combustion_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "run_eocs": [ "mokou_combustion_cycle1" ] }
    ],
    "//": "This EOC is a simplified version of utsuho_fissionaura_eoc "
  },
  {
    "id": "mokou_combustion_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_mokou_combustion", "<", "4" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "mokou_combustion2" }, "targeted": false },
      { "run_eocs": [ "mokou_combustion_cycle2" ] }
    ],
    "false_effect": { "run_eocs": "mokou_combustion_end" }
  },
  {
    "id": "mokou_combustion_cycle2",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_mokou_combustion", "+=", "1" ] },
      { "queue_eocs": [ "mokou_combustion_cycle1" ], "time_in_future": "3 s" }
    ]
  },
  {
    "id": "mokou_combustion_end",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_mokou_combustion", ">=", "4" ] },
    "effect": [
      { "math": [ "var_mokou_combustion", "=", "0" ] }
    ]
  },
  {
    "id": "sakuya_maidsecret_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_sakuyafocus", "+=", "1" ] },
      { "math": [ "var_sakuyaradius", "=", "( - (u_skill('stabbing') * 0.4 ) - (u_skill('dodge') * 0.4 ) + 17.2 )" ] },
      { "run_eocs": [ "sakuya_maidsecret_cycle1" ] }
    ],
    "//": "This EOC is a simplified version of udonge_waveinsight_start ",
    "//2": "var_sakuyaradius sets the detection radius to that formula, 16 - 6 tiles scaling down with higher (stabbing + dodge)"
  },
  {
    "id": "sakuya_maidsecret_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_sakuyafocus", "<", "2" ] },
    "effect": [ { "run_eocs": [ "sakuya_maidsecret_cycle2" ] } ],
    "false_effect": { "run_eocs": "sakuya_maidsecret_toggle" }
  },
  {
    "id": "sakuya_maidsecret_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "100" ] },
        { "math": [ "u_val('stamina')", ">=", "2000" ] },
        { "math": [ "var_sakuyafocus", ">", "0" ] },
        { "math": [ "u_monsters_nearby('radius': var_sakuyaradius )", "<", "1" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('stamina')", "+=", "1" ] },
      { "u_add_effect": "sakuya_maidsecret_effect", "duration": "3 s" },
      { "queue_eocs": [ "sakuya_maidsecret_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "sakuya_maidsecret_broken" }
  },
  {
    "id": "sakuya_maidsecret_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_sakuyafocus", ">=", "2" ] },
    "effect": [
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "sakuya_maidsecret_broken",
    "type": "effect_on_condition",
    "effect": [
      { "u_message": "You lose your concentration.", "type": "mixed" },
      { "math": [ "var_sakuyafocus", "=", "0" ] },
      { "u_lose_effect": "sakuya_maidsecret_effect" }
    ]
  },
  {
    "id": "tenko_keystonecrash_eoc",
    "type": "effect_on_condition",
    "condition": "u_is_outside",
    "effect": [
      { "u_cast_spell": { "id": "tenko_keystonecrash2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need a direct connection to the Heavens to summon a crashing keystone.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ]
  },
  {
    "id": "udonge_disbeliefaspect_eoc",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_monsters_nearby('mon_udonge_firing_squad', 'radius': 16, 'attitude': 'friendly')", "==", "0" ] },
    "effect": [
      { "u_cast_spell": { "id": "udonge_disbeliefaspect_spawn" }, "targeted": false }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "+=", "100" ] },
      { "u_cast_spell": { "id": "udonge_disbeliefaspect_tp" }, "targeted": true }
    ],
    "//": "Simple EOC just checks if there is any Udonge firing squad around. If there isn't then she spawns some and consumes some mana, otherwise she casts the random tp",
    "//2": "Thank you so much andrei8l for #71222"
  },
  {
    "id": "udonge_gunwaveBLAST_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_wielded_with_weapon_category": "AUTOMATIC_PISTOLS" },
    "effect": [
      { "run_eocs": [ "udonge_gunwaveBLAST_BLAST" ] }
    ],
    "false_effect": [ 
      { "u_message": "You don't have any pistols equipped.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "75" ] }
    ],
    "//": "Simple EOC just checks if Udonge is wielding any pistols, if she isn't the cast fails"
  },
  {
    "id": "udonge_gunwaveBLAST_BLAST",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "udonge_gunwaveBLAST2" }, "targeted": true }
    ]
  },
  {
    "id": "udonge_waveinsight_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "+=", "1" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveinsight_cycle1" ] }
    ],
    "//": "Always activates every time the spell udonge_waveinsight is cast. It sets var_waveinsight > 0 to signal that aura is ON. It also sets the other auras OFF",
    "//2": "This is the 'base aura', the others are modeled after this"
  },
  {
    "id": "udonge_waveinsight_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveinsight_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveinsight_toggle" },
    "//": "This is immediately checked after the previous eoc: if the player has casted the spell just once then var_waveinsight < 2, so cycle2 is run. However, if the player has casted the spell twice then var_waveinsight >= 2, so it runs the toggle EOC instead"
  },
  {
    "id": "udonge_waveinsight_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_waveinsight", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "1" ] },
      { "u_add_effect": "udonge_insight", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveinsight_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" },
    "//": "This keeps the aura active as long as the player has enough mana, plus reduces it a bit. Otherwise the udonge_wave_oom stop triggers"
  },
  {
    "id": "udonge_waveinsight_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveinsight", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" }
    ],
    "//": "If the player has cast udonge_waveinsight twice, this runs and deactivates the aura"
  },
  {
    "id": "udonge_wave_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "50" ] },
    "effect": [
      { "u_message": "You are too mentally exhausted!  You lose focus of the wavelengths.", "type": "bad" },
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" }
    ],
    "//": "If the player runs reaches the amount of mana specified above, the aura(s) deactivate"
  },
  {
    "id": "udonge_wavemfortitude_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "+=", "1" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_perception" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_wavemfortitude_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavemfortitude_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavemfortitude_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavemfortitude_toggle" }
  },
  {
    "id": "udonge_wavemfortitude_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_wavemfortitude", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_mfortitude", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavemfortitude_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavemfortitude_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavemfortitude", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "u_lose_effect": "udonge_mfortitude" }
    ]
  },
  {
    "id": "udonge_waveperception_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "+=", "1" ] },
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_stealth" },
      { "run_eocs": [ "udonge_waveperception_cycle1" ] }
    ]
  },
  {
    "id": "udonge_waveperception_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_waveperception_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_waveperception_toggle" }
  },
  {
    "id": "udonge_waveperception_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_waveperception", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "6" ] },
      { "u_add_effect": "udonge_perception", "duration": "3 s" },
      { "queue_eocs": [ "udonge_waveperception_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_waveperception_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_waveperception", ">=", "2" ] },
    "effect": [
      { "math": [ "var_waveperception", "=", "0" ] },
      { "u_lose_effect": "udonge_perception" }
    ]
  },
  {
    "id": "udonge_wavestealth_start",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_waveinsight", "=", "0" ] },
      { "math": [ "var_wavemfortitude", "=", "0" ] },
      { "math": [ "var_waveperception", "=", "0" ] },
      { "math": [ "var_wavestealth", "+=", "1" ] },
      { "u_lose_effect": "udonge_insight" },
      { "u_lose_effect": "udonge_mfortitude" },
      { "u_lose_effect": "udonge_perception" },
      { "run_eocs": [ "udonge_wavestealth_cycle1" ] }
    ]
  },
  {
    "id": "udonge_wavestealth_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", "<", "2" ] },
    "effect": [ { "run_eocs": [ "udonge_wavestealth_cycle2" ] } ],
    "false_effect": { "run_eocs": "udonge_wavestealth_toggle" }
  },
  {
    "id": "udonge_wavestealth_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "50" ] },
        { "math": [ "var_wavestealth", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "10" ] },
      { "u_add_effect": "udonge_stealth", "duration": "3 s" },
      { "queue_eocs": [ "udonge_wavestealth_cycle1" ], "time_in_future": "2 s" }
    ],
    "false_effect": { "run_eocs": "udonge_wave_oom" }
  },
  {
    "id": "udonge_wavestealth_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_wavestealth", ">=", "2" ] },
    "effect": [
      { "math": [ "var_wavestealth", "=", "0" ] },
      { "u_lose_effect": "udonge_stealth" }
    ]
  },
  {
    "id": "utsuho_blacksun_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_hellcannon2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "-=", "50" ] },
      { "u_cast_spell": { "id": "utsuho_hellcannon2_unc" }, "targeted": true } 
    ]
  },
  {
    "id": "utsuho_detectrad_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_detectrad2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "Something's wrong… you cannot detect anything.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "rand(50)" ] }
    ]
  },
  {
    "id": "utsuho_minisun_follow",
    "type": "effect_on_condition",
    "//recurrence": "1 s",
    "condition": {
      "and": [
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", ">", "0" ] },
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 5, 'attitude': 'friendly')", "==", "0" ] }
      ]
    },
    "deactivate_condition": {
      "or": [
        { "not": { "u_has_trait": "PROF_OKUU" } },
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", "==", "0" ] }
      ]
    },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_blacksun2" }, "targeted": false }
    ],
    "//": "WIP"
  },
  {
    "id": "utsuho_fissionaura_eoc",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_utsuho_fissionaura", "+=", "1" ] },
      { "run_eocs": [ "utsuho_fissionaura_check" ] }
    ],
    "//": "This EOC is a modified version of udonge_waveinsight_start . It has an extra step that checks if Utsuho is wearing her rod, if she isn't it runs a sub-cycle with different values"
  },
  {
    "id": "utsuho_fissionaura_check",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "run_eocs": [ "utsuho_fissionaura_cycle1" ] }
    ],
    "false_effect": [ { "run_eocs": [ "utsuho_fissionaura_cycle1_unc" ] } ]
  },
  {
    "id": "utsuho_fissionaura_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", "<", "2" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_fissionaura2" }, "targeted": false },
      { "run_eocs": [ "utsuho_fissionaura_cycle2" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_toggle" }
  },
  {
    "id": "utsuho_fissionaura_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "66" ] },
        { "math": [ "var_utsuho_fissionaura", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "11" ] },
      { "queue_eocs": [ "utsuho_fissionaura_check" ], "time_in_future": "3 s" }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_oom" }
  },
  {
    "id": "utsuho_fissionaura_cycle1_unc",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", "<", "2" ] },
    "effect": [ 
      { "u_cast_spell": { "id": "utsuho_fissionaura2_unc" }, "targeted": false },
      { "run_eocs": [ "utsuho_fissionaura_cycle2_unc" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_toggle" }
  },
  {
    "id": "utsuho_fissionaura_cycle2_unc",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_val('mana')", ">=", "66" ] },
        { "math": [ "var_utsuho_fissionaura", ">", "0" ] }
      ]
    },
    "effect": [
      { "math": [ "u_val('mana')", "-=", "11 + rand(6)" ] },
      { "queue_eocs": [ "utsuho_fissionaura_check" ], "time_in_future": [ "2 s", "4 s" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fissionaura_oom" }
  },
  {
    "id": "utsuho_fissionaura_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fissionaura", ">=", "2" ] },
    "effect": [
      { "math": [ "var_utsuho_fissionaura", "=", "0" ] }
    ]
  },
  {
    "id": "utsuho_fissionaura_oom",
    "type": "effect_on_condition",
    "condition": { "math": [ "u_val('mana')", "<", "66" ] },
    "effect": [
      { "u_message": "You ran out of energy!  The fission controllers return to base operation levels.", "type": "mixed" },
      { "math": [ "var_utsuho_fissionaura", "=", "0" ] }
    ]
  },
  {
    "id": "utsuho_fusionblade_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "math": [ "var_utsuho_fusionblade", "+=", "1" ] },
      { "math": [ "u_val('mana')", "-=", "50" ] },
      { "u_add_effect": "aura_fusionblade", "duration": "80 s" },
      { "run_eocs": [ "utsuho_fusionblade_cycle1" ] }
    ],
    "false_effect": [ { "u_message": "Your third leg is not equipped.", "type": "mixed" } ]
  },
  {
    "id": "utsuho_fusionblade_cycle1",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fusionblade", "<", "2" ] },
    "effect": [ 
      { "run_eocs": [ "utsuho_fusionblade_cycle2" ] }
    ],
    "false_effect": { "run_eocs": "utsuho_fusionblade_toggle" }
  },
  {
    "id": "utsuho_fusionblade_cycle2",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_utsuho_fusionblade", ">", "0" ] },
        { "math": [ "var_utsuho_fusionblade_timer", "<", "( (u_skill('dodge') * 3 ) + 39 )" ] },
        { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" }
      ]
    },
    "effect": [
      { "math": [ "var_utsuho_fusionblade_timer", "+=", "1" ] },
      { "queue_eocs": [ "utsuho_fusionblade_cycle1" ], "time_in_future": "1 s" }
    ],
    "false_effect": [ { "run_eocs": "utsuho_fusionblade_end" } ],
    "//": "dur 45 - 75 s",
    "//2": "This adds +1 to the timer, if it's bigger than the duration at the skill level it ends. It also ends if Utsuho unequips her rod"
  },
  {
    "id": "utsuho_fusionblade_toggle",
    "type": "effect_on_condition",
    "condition": { "math": [ "var_utsuho_fusionblade", ">=", "2" ] },
    "effect": [
      { "math": [ "var_utsuho_fusionblade", "=", "0" ] },
      { "math": [ "var_utsuho_fusionblade_timer", "=", "0" ] },
      { "u_lose_effect": "aura_fusionblade" },
      { "u_message": "You deactivate the fusion blade.", "type": "mixed" }
    ]
  },
  {
    "id": "utsuho_fusionblade_end",
    "type": "effect_on_condition",
    "effect": [
      { "math": [ "var_utsuho_fusionblade", "=", "0" ] },
      { "math": [ "var_utsuho_fusionblade_timer", "=", "0" ] },
      { "u_lose_effect": "aura_fusionblade" },
      { "u_message": "The fusion blade is extinguished.", "type": "mixed" }
    ],
    "//": "WIP. This works but the message is being printed twice by manually deactivating it"
  },
  {
    "id": "utsuho_groundmelt_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_groundmelt2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need to equip your third rod to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "266" ] }
    ]
  },
  {
    "id": "utsuho_hellcannon_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_hellcannon2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "-=", "50" ] },
      { "u_cast_spell": { "id": "utsuho_hellcannon2_unc" }, "targeted": true } 
    ]
  },
  {
    "id": "utsuho_hellcannon_eoc_DUPLICATE",
    "type": "effect_on_condition",
    "//eoc_type": "EVENT",
    "//required_event": "character_casts_spell", 
    "condition": {
      "and": [
        { "compare_string": [ "utsuho_hellcannon", { "context_val": "spell" } ] },
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", ">", "0" ] }
      ]
    },
    "effect": [ 
      { "u_message": "AAA", "type": "mixed" },
      { "math": [ "hellcannon_casted", "+=", "1" ] },
      { "run_eocs": [ "utsuho_hellcannon_eoc2_DUPLICATE" ] }
    ],
    "//": "WIP"
  },
  {
    "id": "utsuho_hellcannon_eoc2_DUPLICATE",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "u_monsters_nearby('mon_utsuho_minisun', 'radius': 99, 'attitude': 'friendly')", ">", "0" ] }
      ]
    },
    "effect": [
      { "u_message": "BBB", "type": "mixed" },
      { "math": [ "hellcannon_casted", "-=", "1" ] },
      { "npc_cast_spell": { "id": "utsuho_hellcannon_mon" }, "targeted": true }
    ],
    "//": "WIP"
  },
  {
    "id": "utsuho_nuke_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_nuke2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You *definitely* need your rod to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "800" ] }
    ],
    "//": "She does? :^)"
  },
  {
    "id": "utsuho_ugeyser_eoc",
    "type": "effect_on_condition",
    "condition": { "u_has_worn_with_flag": "UTSUHO_ROD_FLAG" },
    "effect": [
      { "u_cast_spell": { "id": "utsuho_ugeyser2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "math": [ "u_val('mana')", "-=", "50" ] },
      { "u_cast_spell": { "id": "utsuho_ugeyser2_unc" }, "targeted": true }
    ]
  },
  {
    "id": "yamame_damnedrope_eoc",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_add_trait": "damnedrope_strength_mut" },
      { "queue_eocs": [ "yamame_damnedrope_end" ], "time_in_future": "1 s" }
    ]
  },
  {
    "id": "yamame_damnedrope_end",
    "type": "effect_on_condition",
    "effect": [ 
      { "u_cast_spell": { "id": "yamame_damnedrope2" }, "targeted": true },
      { "u_lose_trait": "damnedrope_strength_mut" }
    ]
  },
  {
    "id": "youmu_slasheternal_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "JAPANESE_SWORDS" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "FENCING_WEAPONRY" },
        { "u_has_wielded_with_weapon_category": "LONG_THRUSTING_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "BIONIC_SWORDS" }
      ]
    },
    "effect": [
      { "run_eocs": [ "youmu_slasheternal_check" ] }
    ],
    "false_effect": [ 
      { "u_message": "You need a sword to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "100" ] }
    ],
    "//": "This EOC is a simplified version of kokoro_backsweep_eoc "
  },
  {
    "id": "youmu_slasheternal_check",
    "type": "effect_on_condition",
    "condition": {
      "and": [
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_bash_dmg" ] },
        { "math": [ "var_melee_cut_dmg", ">=", "var_melee_stab_dmg" ] }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "youmu_slasheternal2_cut" }, "targeted": true }
    ],
    "false_effect": [ { "u_cast_spell": { "id": "youmu_slasheternal2_bash" }, "targeted": true } ]
  },
  {
    "id": "youmu_slashnether_eoc",
    "type": "effect_on_condition",
    "condition": {
      "or": [
        { "u_has_wielded_with_weapon_category": "JAPANESE_SWORDS" },
        { "u_has_wielded_with_weapon_category": "SHORT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "MEDIUM_SWORDS" },
        { "u_has_wielded_with_weapon_category": "LONG_SWORDS" },
        { "u_has_wielded_with_weapon_category": "FENCING_WEAPONRY" },
        { "u_has_wielded_with_weapon_category": "LONG_THRUSTING_SWORDS" },
        { "u_has_wielded_with_weapon_category": "GREAT_SWORDS" },
        { "u_has_wielded_with_weapon_category": "BIONIC_SWORDS" }
      ]
    },
    "effect": [
      { "u_cast_spell": { "id": "youmu_slashnether2" }, "targeted": true }
    ],
    "false_effect": [ 
      { "u_message": "You need a sword to cast this.", "type": "mixed" },
      { "math": [ "u_val('mana')", "+=", "100" ] }
    ],
    "//": "This EOC is a simplified version of kokoro_backsweep_eoc "
  }
]
